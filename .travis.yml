language: cpp
os: linux
dist: focal
compiler: gcc
branches:
  only:
    - master

jobs:
  include:
    - stage: build
      before_install: ./scripts/ci_dependencies.sh
      name: "Debug build"
      script: ./scripts/ci_debug_build.sh
    - # continue in build
      before_install: ./scripts/ci_dependencies.sh
      name: "Release build"
      script: ./scripts/ci_release_build.sh
      workspaces:
        create:
          name: release-binaries
          paths: .
    - stage: documentation
      before_install:
        - sudo apt-get update
        - sudo apt-get -y install doxygen graphviz
      name: "Generate Doxygen documentation and deploy it to GitHub pages"
      script: doxygen Doxyfile
      deploy:
        edge: true
        provider: pages
        strategy: git
        local_dir: docs
        token: $GH_REPO_TOKEN
        on:
          branch: master
    - stage: benchmarks
      before_install:
        - sudo apt-get update
        - sudo apt-get -y install libbenchmark1
      name: "Run benchmarks"
      workspaces:
        use: release-binaries
      script: ./Benchmarks/build/Release/Benchmarks

stages:
  - build
  - documentation
  - benchmarks